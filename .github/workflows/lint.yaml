name: Linting
on:
  pull_request:
jobs:
  golangci:
    name: Linting
    runs-on: ubuntu-latest
    steps:
      - name: Check out Code
        uses: actions/checkout@v3
      - name: Install Nix
        uses: cachix/install-nix-action@daddc62a2e67d1decb56e028c9fa68344b9b7c2a # v18
        with:
          nix_path: nixpkgs=channel:nixos-unstable
      - name: Parse version
        id: parse
        run: |
          long=$(nix develop -c golangci-lint version | grep "golangci-lint has version")
          stringArray=($long)
          version=$(echo "${stringArray[3]}")
          echo "version found: ${version}"
          echo "version=${version}" >>$GITHUB_OUTPUT
      - name: golangci-lint
        uses: golangci/golangci-lint-action@v3
        with:
          version: v${{ steps.parse.outputs.version }}

  vulnerabilities-check:
    name: Check for Vulnerabilities
    runs-on: ubuntu-latest
    steps:
      - name: Check out Code
        uses: actions/checkout@v3
      - name: Install Nix
        uses: cachix/install-nix-action@daddc62a2e67d1decb56e028c9fa68344b9b7c2a # v18
        with:
          nix_path: nixpkgs=channel:nixos-unstable
      - name: Write Go List
        run: nix develop -c make golist
      - name: Nancy
        uses: sonatype-nexus-community/nancy-github-action@main
